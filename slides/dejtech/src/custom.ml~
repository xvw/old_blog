open Bootstrapper

(* Side effects *)
let current_slide = ref 0

(* Low level function *)

let doc =
  Dom_html.document ## documentElement
    
let set_opacity elt value =
  elt ## style ## opacity <- (Js.Optdef.return (_s value))
                             
let hide elt =
  set_opacity elt "0"
    
let show elt =
  set_opacity elt "100"
    
let slides () =
  Html.select_nodes doc ".slide"
    
let hide_slides () =
  List.iter hide (slides ())


let show_current_slide () =
  let slides = slides () in
  let () = List.iter hide slides in
  List.iteri
    (fun i e -> if i = !current_slide then show e)
    slides

let next () =
  let _ =
    if !current_slide < (List.length (slides ())) -1
    then current_slide := !current_slide + 1
  in Lwt.return (show_current_slide ())

let prev () =
  let _ =
    if !current_slide > 0
    then current_slide := !current_slide - 1
  in Lwt.return (show_current_slide ())

let bind_event () =
  let open Event in
  let _ =
    doc >-(mouseup, fun _ _ -> next ()) |> ignore
  in 
  let _ =
    async_loop
      mousewheel
      doc
      (fun (e, (x, y)) _ ->
         if y > 0 then next () else prev ())
  in ()
    

(* Initialize *)
    
let () =
  show_current_slide ();
  bind_event ()
    
